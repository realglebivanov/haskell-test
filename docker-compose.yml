version: '3.5'

services:
  test:
    build: .
    command: stack exec test
    working_dir: /app
  app:
    dns: 8.8.8.8
    build: .
    command: stack exec main
    working_dir: /app
    environment:
      PG_HOST: postgres
      PG_PORT: 5432
      PG_USER: postgres
      PG_PASSWORD: postgres
      PG_DATABASE: haskell_test
    depends_on:
      - postgres
    networks:
      - haskell-test
    ports:
      - "3000:3000"
  postgres:
    image: postgres
    command: createdb haskell_test -U postgres
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
    networks:
      haskell-test:
        aliases:
        - postgres
networks:
  haskell-test:
    external: false
